# organizr-tab-controller â€“ security-hardened defaults.
# Only the resources the controller needs; no ingress, no persistence, no root.
# Parent chart (bjw-s app-template) features we do not use are disabled below.

fullnameOverride: organizr-tab-controller

rbac:
  create: true

hpa:
  enabled: true
  minReplicas: 1
  maxReplicas: 3

organizr-tab-controller:
  global:
    fullnameOverride: organizr-tab-controller

  ingress:
    main:
      enabled: false

  persistence: {}

  # Security baseline: non-root, no privilege escalation, no extra capabilities.
  defaultPodOptions:
    securityContext:
      runAsNonRoot: true
      runAsUser: 65532
      runAsGroup: 65532

  controllers:
    main:
      enabled: true
      type: deployment
      replicas: 1
      serviceAccount:
        name: organizr-tab-controller
      containers:
        main:
          image:
            # Align with Docker workflow (publishes to Docker Hub). Override if using GHCR or different registry.
            repository: docker.io/jd4883/organizr-tab-controller
            # Default for dev (Git installs). Released chart tarballs get tag = chart version in CI.
            tag: latest
            pullPolicy: IfNotPresent
          env:
            ORGANIZR_API_URL: ""
            ORGANIZR_SYNC_POLICY: upsert
            ORGANIZR_LOG_LEVEL: INFO
            ORGANIZR_API_KEY:
              valueFrom:
                secretKeyRef:
                  name: organizr-api-key
                  key: api-key
          securityContext:
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities:
              drop: ["ALL"]
          resources:
            requests:
              cpu: 50m
              memory: 64Mi
            limits:
              cpu: 200m
              memory: 128Mi
          probes:
            startup:
              enabled: false
            liveness:
              enabled: false
            readiness:
              enabled: false

  service:
    main:
      enabled: true
      controller: main
      primary: true
      ports:
        http:
          enabled: true
          port: 8080
